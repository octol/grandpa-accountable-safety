<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Outline - Accountable Safety for GRANDPA</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="outline.html" class="active"><strong aria-hidden="true">2.</strong> Outline</a></li><li class="chapter-item expanded "><a href="example.html"><strong aria-hidden="true">3.</strong> Example</a></li><li class="chapter-item expanded "><a href="implementation.html"><strong aria-hidden="true">4.</strong> Implementation</a></li><li class="chapter-item expanded "><a href="todo.html"><strong aria-hidden="true">5.</strong> TODO</a></li><li class="chapter-item expanded "><a href="references.html"><strong aria-hidden="true">6.</strong> References</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Accountable Safety for GRANDPA</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<h1 id="outline-of-the-procedure"><a class="header" href="#outline-of-the-procedure">Outline of the Procedure</a></h1>
<p>With these definitions we can begin outlining the procedure to track down
equivocating voters.</p>
<h2 id="step-0"><a class="header" href="#step-0">Step 0.</a></h2>
<p>The first step is detecting blocks B and B' on two different branches being
finalized. If these two blocks were finalized in the same round, we can take
the union of the set of precommits to quickly find the equivocators. So let's
assume that B' was finalized in a later round r' than B, which was finalized in
round r. That is, r'&gt; r.</p>
<div><!-- Generated by graphviz version 2.43.0 (0)
 --><!-- Title: %3 Pages: 1 --><svg width="432pt" height="98pt"
 viewBox="0.00 0.00 432.00 98.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 94)"><title>%3</title><polygon fill="white" stroke="transparent" points="-4,4 -4,-94 428,-94 428,4 -4,4"/><!-- 1 --><g id="node1" class="node"><title>1</title><polygon fill="none" stroke="black" points="54,-63 0,-63 0,-27 54,-27 54,-63"/><text text-anchor="middle" x="27" y="-41.3" font-family="Times,serif" font-size="14.00">1</text></g><!-- 2 --><g id="node2" class="node"><title>2</title><polygon fill="none" stroke="black" points="144,-63 90,-63 90,-27 144,-27 144,-63"/><text text-anchor="middle" x="117" y="-41.3" font-family="Times,serif" font-size="14.00">2</text></g><!-- 1&#45;&gt;2 --><g id="edge1" class="edge"><title>1&#45;&gt;2</title><path fill="none" stroke="black" d="M54.4,-45C62.39,-45 71.31,-45 79.82,-45"/><polygon fill="black" stroke="black" points="79.92,-48.5 89.92,-45 79.92,-41.5 79.92,-48.5"/></g><!-- 3 --><g id="node3" class="node"><title>3</title><polygon fill="none" stroke="black" points="234,-90 180,-90 180,-54 234,-54 234,-90"/><text text-anchor="middle" x="207" y="-68.3" font-family="Times,serif" font-size="14.00">3</text></g><!-- 2&#45;&gt;3 --><g id="edge2" class="edge"><title>2&#45;&gt;3</title><path fill="none" stroke="black" d="M144.4,-53.1C152.48,-55.58 161.51,-58.35 170.1,-60.99"/><polygon fill="black" stroke="black" points="169.33,-64.41 179.92,-64 171.39,-57.72 169.33,-64.41"/></g><!-- 5 --><g id="node5" class="node"><title>5</title><polygon fill="none" stroke="black" points="234,-36 180,-36 180,0 234,0 234,-36"/><text text-anchor="middle" x="207" y="-14.3" font-family="Times,serif" font-size="14.00">5</text></g><!-- 2&#45;&gt;5 --><g id="edge4" class="edge"><title>2&#45;&gt;5</title><path fill="none" stroke="black" d="M144.4,-36.9C152.48,-34.42 161.51,-31.65 170.1,-29.01"/><polygon fill="black" stroke="black" points="171.39,-32.28 179.92,-26 169.33,-25.59 171.39,-32.28"/></g><!-- B = 4 --><g id="node4" class="node"><title>B = 4</title><polygon fill="none" stroke="black" points="327,-90 270,-90 270,-54 327,-54 327,-90"/><text text-anchor="middle" x="298.5" y="-68.3" font-family="Times,serif" font-size="14.00">B = 4</text></g><!-- 3&#45;&gt;B = 4 --><g id="edge3" class="edge"><title>3&#45;&gt;B = 4</title><path fill="none" stroke="black" d="M234.37,-72C242.29,-72 251.13,-72 259.64,-72"/><polygon fill="black" stroke="black" points="259.76,-75.5 269.76,-72 259.76,-68.5 259.76,-75.5"/></g><!-- 6 --><g id="node6" class="node"><title>6</title><polygon fill="none" stroke="black" points="325.5,-36 271.5,-36 271.5,0 325.5,0 325.5,-36"/><text text-anchor="middle" x="298.5" y="-14.3" font-family="Times,serif" font-size="14.00">6</text></g><!-- 5&#45;&gt;6 --><g id="edge5" class="edge"><title>5&#45;&gt;6</title><path fill="none" stroke="black" d="M234.37,-18C242.74,-18 252.16,-18 261.11,-18"/><polygon fill="black" stroke="black" points="261.32,-21.5 271.32,-18 261.32,-14.5 261.32,-21.5"/></g><!-- B&#39; = 7 --><g id="node7" class="node"><title>B&#39; = 7</title><polygon fill="none" stroke="black" points="424,-36 363,-36 363,0 424,0 424,-36"/><text text-anchor="middle" x="393.5" y="-14.3" font-family="Times,serif" font-size="14.00">B&#39; = 7</text></g><!-- 6&#45;&gt;B&#39; = 7 --><g id="edge6" class="edge"><title>6&#45;&gt;B&#39; = 7</title><path fill="none" stroke="black" d="M325.9,-18C334.25,-18 343.67,-18 352.74,-18"/><polygon fill="black" stroke="black" points="352.76,-21.5 362.76,-18 352.76,-14.5 352.76,-21.5"/></g></g></svg></div>
<p>This occurs when a node detects commit messages for mutually conflicting
blocks. At this point they trigger the accountable safety protocol.</p>
<h2 id="step-1-start-asking-questions-about-b"><a class="header" href="#step-1-start-asking-questions-about-b">Step 1. Start asking questions about B'</a></h2>
<p>When we have two blocks that are finalized on conflicting branches, we
naturally ask ourselves, when the latter block was voted for, why wasn't the
former into taken into account? More precisely, when finalizing B' in round r',
why didn't the estimate for the preceeding round include B. Recall that the
estimate for the previous round includes all blocks that could possible be
finalized in that round.</p>
<p>For this step we assume that r' &gt; r + 1, that is, there are at least a two
rounds separation between finalizing B and B'. Should r' = r + 1, we can skip
to step 2 below.</p>
<p>We send out requests to all voters in the commit for B', asking:</p>
<blockquote>
<p><em>Why did the estimate for the preceeding round not include B when prevoting
or precommitting for B'?</em></p>
</blockquote>
<p>A valid answer is a set S of entirely either of prevotes or precommits for the
preceeding round r'-1, such that it's impossible for S to have a supermajority
for B.</p>
<p>Since the estimate is defined in terms of both prevotes and precommits,
prevotes indirectly through the GHOST function, and precommits directly, we
accept answers containing either of these, but not a mix.</p>
<p>The point of these questions is that we can successively step backwards round
by round until we reach round r+1, which is the round after the first block B
was finalized.</p>
<p>We don't need every voter to reply, as long as we have a single reply
containing the voter set S we can make progress. Only in the case when we get
no replies at all do we consider the non-responders as Byzantine.</p>
<p>We keep sending out requests asking why the estimate in each round didn't
include B, until we get a reply for the estimate of round r+1.</p>
<h2 id="step-2-reach-the-round-after-which-b-was-finalized"><a class="header" href="#step-2-reach-the-round-after-which-b-was-finalized">Step 2. Reach the round after which B was finalized</a></h2>
<p>Once we get a reply containing votes S for the round r+1, we reach a point
where we can start to get closure.</p>
<p>At this point, when we are in round r+1, our request for estimate of the
preceding round will now be be answered with a set of votes that are from the
same round as the first block B was finalized in.</p>
<p>If the reply is in the form of a set S of precommits, we can take the union
with the precommits in the commits message for B to find equivocators. With
this we can terminate the protocol as we've found a set of Byzantine voters.
Not necessarily all of them, but more than the threshold for when Byzantine
consensus can be subverted.</p>
<p>Now if for this step, if the reply to the request is instead a set S of
prevotes, we need to take one additional step before we can home in on the
equivocators.</p>
<h2 id="step-3-instead-ask-the-precommitters-for-b"><a class="header" href="#step-3-instead-ask-the-precommitters-for-b">Step 3. Instead ask the precommitters for B</a></h2>
<p>To be able to find the equivocators we need something to compare the reply from step 2 against. As such, we send a request to all voters in the commit for block B, asking:</p>
<blockquote>
<p><em>What prevotes have you seen for round r?</em></p>
</blockquote>
<p>A valid reply is a set T of prevotes with a supermajority for B. With this we
can now take the union between T and S to find the equivocators.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="example.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="example.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
